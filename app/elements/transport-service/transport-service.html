<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/iron-ajax/iron-ajax.html">
<dom-module id="transport-service">
  <template>
  
<iron-ajax
        method="post"
        id="getrouteajax"
        url="{{getrouteurl}}"
        handle-as="json"
        content-type="application/json"
        on-response="getrouteResponse"
        debounce-duration="300"
        >
  </iron-ajax>
  <iron-ajax
        method="post"
        id="getroutedetailajax"
        url="{{getroutedetailurl}}"
        params="{{getroutedetailparam}}"
        handle-as="json"
        content-type="application/json"
        on-response="getroutedetailResponse"
        debounce-duration="300"
        >
  </iron-ajax>
    <iron-ajax
        method="post"
        id="insertpointajax"
        url="{{insertpointurl}}"
        params="{{insertpointparam}}"
        handle-as="json"
        content-type="application/json"
        on-response="insertpointResponse"
        debounce-duration="300"
        >
  </iron-ajax>
      <iron-ajax
        method="post"
        id="routeidajax"
        url="{{routeidurl}}"
        params="{{routeidparam}}"
        handle-as="json"
        content-type="application/json"
        on-response="routeidResponse"
        debounce-duration="300"
        >
  </iron-ajax>

 </iron-ajax>
      <iron-ajax
        method="post"
        id="sequenceajax"
        url="{{sequenceurl}}"
        handle-as="json"
        content-type="application/json"
        on-response="sequenceResponse"
        debounce-duration="300"
        >
  </iron-ajax>

  <iron-ajax
        method="post"
        id="getzoneajax"
        url="{{getzoneurl}}"
        handle-as="json"
        content-type="application/json"
        on-response="getzoneResponse"
        debounce-duration="300"
        >
  </iron-ajax>
  <iron-ajax
        method="post"
        id="getfeeajax"
        url="{{getfeeurl}}"
        params="{{getfeeparam}}"
        handle-as="json"
        content-type="application/json"
        on-response="getfeeResponse"
        debounce-duration="300"
        >
  </iron-ajax>
 <iron-ajax
        method="post"
        id="setzoneajax"
        url="{{setzoneurl}}"
        params="{{setzoneparam}}"
        handle-as="json"
        content-type="application/json"
        on-response="setzoneResponse"
        debounce-duration="300"
        >
  </iron-ajax>

  <iron-ajax
        method="post"
        id="getnameajax"
        url="{{getnameurl}}"
        params="{{getnameparam}}"
        handle-as="json"
        content-type="application/json"
        on-response="getnameResponse"
        debounce-duration="300"
        >
  </iron-ajax>
  <iron-ajax
        method="post"
        id="getstudetailajax"
        url="{{getstudetailurl}}"
        params="{{getstudetailparam}}"
        handle-as="json"
        content-type="application/json"
        on-response="getstudetailResponse"
        debounce-duration="300"
        >
  </iron-ajax>
  <iron-ajax
        method="post"
        id="getrouteajax"
        url="{{getrouteurl}}"
        handle-as="json"
        content-type="application/json"
        on-response="getrouteResponse"
        debounce-duration="300"
        >
  </iron-ajax>
   <iron-ajax
        method="post"
        id="genereportajax"
        url="{{genereporturl}}"
        params="{{genereportparam}}"
        handle-as="json"
        content-type="application/json"
        on-response="genereportResponse"
        debounce-duration="300"
        >
  </iron-ajax>
   <iron-ajax
        method="post"
        id="gettripajax"
        url="{{gettripurl}}"
        params="{{gettripparam}}"
        handle-as="json"
        content-type="application/json"
        on-response="gettripResponse"
        debounce-duration="300"
        >
  </iron-ajax>
 
   <iron-ajax
        method="post"
        id="cancellationajax"
        url="{{cancellationurl}}"
        params="{{cancellationparam}}"
        handle-as="json"
        content-type="application/json"
        on-response="cancellationResponse"
        debounce-duration="300"
        >
  </iron-ajax>
   <iron-ajax
        method="post"
        id="cancelajax"
        url="{{cancelurl}}"
        params="{{cancelparam}}"
        handle-as="json"
        content-type="application/json"
        on-response="cancelResponse"
        debounce-duration="300"
        >
  </iron-ajax>
   <iron-ajax
        method="post"
        id="proceedcancelajax"
        url="{{proceedcancelurl}}"
        params="{{proceedcancelparam}}"
        handle-as="json"
        content-type="application/json"
        on-response="proceedcancelResponse"
        debounce-duration="300"
        >
  </iron-ajax>
   <iron-ajax
        method="post"
        id="transportrequiredstatusajax"
        url="{{transportrequiredstatusurl}}"
        params="{{transportrequiredstatusparam}}"
        handle-as="json"
        content-type="application/json"
        on-response="transportrequiredstatusResponse"
        debounce-duration="300"
        >
  </iron-ajax>
    <iron-ajax
        method="post"
        id="gettermdateajax"
        url="{{gettermdateurl}}"
        params="{{gettermdateparam}}"
        handle-as="json"
        content-type="application/json"
        on-response="gettermdateResponse"
        debounce-duration="300"
        >
  </iron-ajax>
   <iron-ajax
        method="post"
        id="nameajax"
        url="{{nameurl}}"
        handle-as="json"
        content-type="application/json"
        on-response="nameResponse"
        debounce-duration="300"
        >
  </iron-ajax>
  <iron-ajax
        method="post"
        id="generatereportbynameajax"
        url="{{generatereportbynameurl}}"
        handle-as="json"
        content-type="application/json"
        on-response="generatereportbynameResponse"
        debounce-duration="300"
        >
  </iron-ajax>
  <iron-ajax
        method="post"
        id="generateroutereportajax"
        url="{{generateroutereporturl}}"
        handle-as="json"
        content-type="application/json"
        on-response="generateroutereportResponse"
        debounce-duration="300"
        >
  </iron-ajax>
  <iron-ajax
        method="post"
        id="deletemappointajax"
        url="{{deletemappointurl}}"
        params="{{deletemappointparam}}"
        handle-as="json"
        content-type="application/json"
        on-response="deletemappointResponse"
        debounce-duration="300"
        >
        </iron-ajax>
          <iron-ajax
        method="post"
        id="getstudapprovalajax"
        url="{{getstudapprovalurl}}"
        handle-as="json"
        content-type="application/json"
        on-response="getstudapprovalResponse"
        debounce-duration="300"
        >
  </iron-ajax>
     <iron-ajax
        method="post"
        id="confirmdiscajax"
        url="{{confirmdiscurl}}"
        params="{{confirmdiscparam}}"
        handle-as="json"
        content-type="application/json"
        on-response="confirmdiscResponse"
        debounce-duration="300"
        >
  </iron-ajax>
   </iron-ajax>
     <iron-ajax
        method="post"
        id="getapprovalverifyajax"
        url="{{getapprovalverifyurl}}"
        params="{{getapprovalverifyparam}}"
        handle-as="json"
        content-type="application/json"
        on-response="getapprovalverifyResponse"
        debounce-duration="300"
        >
  </iron-ajax>
   <iron-ajax
        method="post"
        id="confirmedfeeajax"
        url="{{confirmedfeeurl}}"
        params="{{confirmedfeeparam}}"
        handle-as="json"
        content-type="application/json"
        on-response="confirmedfeeResponse"
        debounce-duration="300"
        >
  </iron-ajax>
  <iron-ajax
        method="post"
        id="confirmfeeajax"
        url="{{confirmfeeurl}}"
        params="{{confirmfeeparam}}"
        handle-as="json"
        content-type="application/json"
        on-response="confirmfeeResponse"
        debounce-duration="300"
        >
  </iron-ajax>
  <iron-ajax
        method="post"
        id="cancelledfeeajax"
        url="{{cancelledfeeurl}}"
        params="{{cancelledfeeparam}}"
        handle-as="json"
        content-type="application/json"
        on-response="cancelledfeeResponse"
        debounce-duration="300"
        >
  </iron-ajax>
   <iron-ajax
        method="post"
        id="classajax"
        url="{{classurl}}"
        params="{{classparam}}"
        handle-as="json"
        content-type="application/json"
        on-response="classResponse"
        debounce-duration="300"
        >
  </iron-ajax>
   <iron-ajax
        method="post"
        id="statuschangeajax"
        url="{{statuschangeurl}}"
        params="{{statuschangeparam}}"
        handle-as="json"
        content-type="application/json"
        on-response="statuschangeResponse"
    >
  </iron-ajax>
  <iron-ajax
        method="post"
        id="studzoneajax"
        url="{{studzoneurl}}"
        params="{{studzoneparam}}"
        handle-as="json"
        content-type="application/json"
        on-response="studzoneResponse"
        debounce-duration="300"
        >
  </iron-ajax>
  <iron-ajax
        method="post"
        id="pointflagajax"
        url="{{pointflagurl}}"
        params="{{pointflagparam}}"
        handle-as="json"
        content-type="application/json"
        on-response="pointflagResponse"
        debounce-duration="300">
       </iron-ajax>
  <iron-ajax
        id="updatezoneajax"
        url="{{updatezoneurl}}"
        params="{{updatezoneparam}}"
        handle-as="json"
        content-type="application/json"
        on-response="updatezoneResponse"
        >
  </iron-ajax>
  <iron-ajax
        method="post"
        id="routereportajax"
        url="{{routereporturl}}"
        params="{{routereportparam}}"
        handle-as="json"
        content-type="application/json"
        on-response="routereportResponse">
</iron-ajax>


 <iron-ajax
        method="post"
        id="studentpickroutereportajax"
        url="{{studentpickroutereporturl}}"
        params="{{studentpickroutereportparam}}"
        handle-as="json"
        content-type="application/json"
        on-response="studentpickroutereportResponse">
</iron-ajax>

<iron-ajax
        method="post"
        id="studentdroproutereportajax"
        url="{{studentdroproutereporturl}}"
        params="{{studentdroproutereportparam}}"
        handle-as="json"
        content-type="application/json"
        on-response="studentdroproutereportResponse">
</iron-ajax>

  <iron-ajax
        id="onewayajax"
        url="{{onewayurl}}"
        handle-as="json"
        content-type="application/json"
        on-response="onewayResponse"
        debounce-duration="300"
        >
  </iron-ajax>
  <iron-ajax
        
        id="onecusajax"
        url="{{onecusurl}}"
        handle-as="json"
        content-type="application/json"
        on-response="onecusResponse"
        debounce-duration="300"
        >
  </iron-ajax>
  
   <iron-ajax
        method="post"
        id="getpassdetailajax"
        url="{{getpassdetailurl}}"
        params="{{getpassdetailparam}}"
        handle-as="json"
        content-type="application/json"
        on-response="getpassdetailResponse"
        debounce-duration="300"
        >
  </iron-ajax>
  <iron-ajax
        method="post"
        id="getppnameajax"
        url="{{getppnameurl}}"
        params="{{getppnameparam}}"
        handle-as="json"
        content-type="application/json"
        on-response="getppnameResponse"
        debounce-duration="300"
        >
  </iron-ajax>
   <iron-ajax
        method="post"
        id="getdpnameajax"
        url="{{getdpnameurl}}"
        params="{{getdpnameparam}}"
        handle-as="json"
        content-type="application/json"
        on-response="getdpnameResponse"
        debounce-duration="300"
        >
  </iron-ajax>
  <iron-ajax
        method="post"
        id="getpassnameajax"
        url="{{getpassnameurl}}"
        params="{{getpassnameparam}}"
        handle-as="json"
        content-type="application/json"
        on-response="getpassnameResponse"
        debounce-duration="300"
        >
  </iron-ajax>
  <iron-ajax
        method="post"
        id="getpassclassajax"
        url="{{getpassclassurl}}"
        params="{{getpassclassparam}}"
        handle-as="json"
        content-type="application/json"
        on-response="getpassclassResponse"
        debounce-duration="300"
        >
  </iron-ajax>
  <iron-ajax
        method="post"
        id="getparentinfoajax"
        url="{{getparentinfourl}}"
        params="{{getparentinfoparam}}"
        handle-as="json"
        content-type="application/json"
        on-response="getparentinfoResponse"
        debounce-duration="300"
        >
  </iron-ajax>
    </template>

  <script>
  (function() {
    var point;
    var trip;
    var pick;
    var drop;
    var routeidd;
    var routetrip="";
    var totalfee;
    var months;
    var calcfee;
    var cancelfee;
    var cancelpaid;
    var cusfee;
    var yearlyfee;
    var val;
    var oneway;
    var zstuname;
    var distance;


    Polymer({
      is: "transport-service",
      
     
       getroute:function()
      {
        this.getrouteurl=sessionStorage.getItem("addrinfo")+"/getroute";
        this.$.getrouteajax.generateRequest();
      },
      getrouteResponse:function(e1)
      {
         a2=e1.detail.response.returnval;
        document.querySelector('mappointtoroute-card').routearr=a2;
      },
       getroutedetail:function(tripno)
      {
        //alert('Hi  ...   '+routetrip);
        this.getroutedetailurl=sessionStorage.getItem("addrinfo")+"/getroutedetail";
        var obj={"routename":"","tripnos":""};
        obj.routename=routetrip;
        obj.tripnos=tripno;
        this.getroutedetailparam=obj;
        //alert(JSON.stringify(obj));
        this.$.getroutedetailajax.generateRequest();
      },
      getroutedetailResponse:function(e1)
          { 
          var routedetails=e1.detail.response.returnval;
          //alert(JSON.stringify(routedetails));
          document.querySelector('mappointtoroute-card').itemarr=routedetails;
      },

      insertpoint:function(route,pt,pickuptime,droptime,tripp,dist)
      {
        point=pt;
        trip=tripp;
        pick=pickuptime;
        drop=droptime;
        distance=dist;
        this.routeidurl=sessionStorage.getItem("addrinfo")+"/routeid";
        var obj={"routename":""};
        obj.routename=route;
        this.routeidparam=obj;
        this.$.routeidajax.generateRequest();
      },
      insertpointResponse:function(e){
        var result=e.detail.response.returnval;
        if(result=='success')
        {
            alert('The point is mapped to route');
            document.querySelector('mappointtoroute-card').refreshdeletedata();
        }
        else
        {
            alert('The point is not mapped to route');
        }
      },
      routeidResponse:function(e)
      {
        routeidd=e.detail.response.returnval[0].id;
         this.sequenceurl=sessionStorage.getItem("addrinfo")+"/sequence";
         this.$.sequenceajax.generateRequest();

      },
      sequenceResponse:function(e)
      {
        var seq=(e.detail.response.returnval[0].count)+1;
        var obj={"id":"","routes":"","points":"","trip":"","pick":"","drop":"","distance":""};
        obj.id="p"+seq;
        obj.routes=routeidd;
        obj.points=point;
        obj.trip=trip;
        obj.pick=pick;
        obj.drop=drop;
        obj.distance=distance;
        this.insertpointparam=obj;
        this.insertpointurl=sessionStorage.getItem("addrinfo")+"/insertpoint";
        this.$.insertpointajax.generateRequest();

      },
         getzone:function()

      {
        this.getzoneurl=sessionStorage.getItem("addrinfo")+"/getzone";
        this.$.getzoneajax.generateRequest();
      },
      getzoneResponse:function(e1)
          {
            var zoneitem=e1.detail.response.returnval;
            document.querySelector('zonetostudent-card').itemarr=zoneitem;
      },
      getfee:function(zone)
      {
        this.getfeeurl = sessionStorage.getItem("addrinfo")+"/getfee";
        var obj={"zone":""}
        obj.zone=zone;
        this.getfeeparam=obj;
        this.$.getfeeajax.generateRequest();
      },
      getfeeResponse:function(e){
         totalfee=e.detail.response.returnval[0].fees;
          document.querySelector('zonetostudent-card').fee=totalfee;
      },
      calc:function(values){
      if(values=='foryear'){
        yearlyfee=totalfee;
        //alert(yearlyfee);
   }
      },
      gettermdate:function(grade){
         this.gettermdateurl=sessionStorage.getItem("addrinfo")+"/gettermdate";
         var obj={"grade":""}
         obj.grade=grade;
         this.gettermdateparam=obj;
        this.$.gettermdateajax.generateRequest();
      },
         gettermdateResponse:function(e1)
          {
            var fromdate1=e1.detail.response.returnval[0].start_date;
            var todate1=e1.detail.response.returnval[0].end_date;
            document.querySelector('zonetostudent-card').zfromdate=fromdate1;
            document.querySelector('zonetostudent-card').ztodate=todate1;
            document.querySelector('zonetostudent-card').setzonedate(fromdate1,todate1);

      },
      setzone:function(studid,zone,fee,fromdatez,todatez,modez,namex,todayx,statusx,stuname)
      {
        zstuname=stuname;
        this.setzoneurl = sessionStorage.getItem("addrinfo")+"/setzone";
        var obj={"studid":"","zone":"","fee":"","fromdate":"","todate":"","mode":"","name":"","today":"","status":""};
        obj.studid=studid;
        obj.zone=zone;
        obj.fee=fee;
        obj.fromdate=fromdatez;
        obj.todate=todatez;
        obj.mode=modez;
        obj.name=namex;
        obj.today=todayx;
        obj.status=statusx;
        this.setzoneparam=obj;
       // alert(JSON.stringify(obj));
        this.$.setzoneajax.generateRequest();
      },
      setzoneResponse:function(e){
         var result=e.detail.response.returnval;
         //alert(result);
         if(result=="success")
         {
          alert('Zone allocated successfully');
          document.querySelector('transportfee-service').zonefee(zstuname);
          document.querySelector('zonetostudent-card').hidetransport=false;
         }
         else
         {
          alert('The data is not inserted');
         }
      },

      
       getname:function()
      {
        //alert('hi service');
        this.getnameurl=sessionStorage.getItem("addrinfo")+"/getname";
        this.$.getnameajax.generateRequest();
      },
      getnameResponse:function(e1)
          {
            var iditem=e1.detail.response.returnval;
            //document.querySelector('zonetostudent-card').studentidarr=iditem;
            document.querySelector('zonetostudent-card').autocompletearr(iditem);
            //document.querySelector('studentpass-card').autocompletearr(iditem);
            //alert(JSON.stringify(document.querySelector('zonetostudent-card').namearr));
      },

      getstudetail:function(studid)
      {
        this.getstudetailurl=sessionStorage.getItem("addrinfo")+"/getstudetail";
        var obj={"studid":""};
        obj.studid=studid;
        this.getstudetailparam=obj;
        this.$.getstudetailajax.generateRequest();
      },
      getstudetailResponse:function(e1)
          {
            var profilename=e1.detail.response.returnval[0].student_name;
            var gradename=e1.detail.response.returnval[0].school_type;
            var dob=e1.detail.response.returnval[0].dob;
            var stdid=e1.detail.response.returnval[0].id;
            var classz=e1.detail.response.returnval[0].class_id;
            document.querySelector('zonetostudent-card').name=profilename;
            document.querySelector('zonetostudent-card').grade=gradename;
            document.querySelector('zonetostudent-card').date=dob;
            document.querySelector('zonetostudent-card').id=stdid;
           
            this.classurl=sessionStorage.getItem("addrinfo")+"/getclass";
            var obj1={"class":""}
            obj1.class=classz;
            this.classparam=obj1;
            this.$.classajax.generateRequest();

      },
      classResponse:function(e){
        var stnd=e.detail.response.returnval[0].class;
        var secn=e.detail.response.returnval[0].section;
        document.querySelector('zonetostudent-card').stnd=stnd;
        document.querySelector('zonetostudent-card').secn=secn;
      },
      
      generatereport:function(studid){
        this.genereporturl=sessionStorage.getItem("addrinfo")+"/report-card";
        var obj={"studid":""}
        obj.studid=studid;
        this.genereportparam=obj;
        this.$.genereportajax.generateRequest();
      },
      genereportResponse:function(e){
        //alert(JSON.stringify(e.detail.response.returnval));
        var reportresult=e.detail.response.returnval;
        document.querySelector('genestureport-card').reportarr=reportresult;
      },
      generateroutereport:function(){
        this.generateroutereporturl=sessionStorage.getItem("addrinfo")+"/generateroutereport";
        this.$.generateroutereportajax.generateRequest();
      },
      generateroutereportResponse:function(e){
        var nameitem=e.detail.response.returnval;
        document.querySelector('routereport-card').autocompletename(nameitem);
      },
      routereport:function(routeid){
        this.routereporturl=sessionStorage.getItem("addrinfo")+"/route-report-card";
        var obj={"routeid":""}
        obj.routeid=routeid;
        this.routereportparam=obj;
        //alert(JSON.stringify(obj));
        this.$.routereportajax.generateRequest();
      },
     
      routereportResponse:function(e){
        //alert(JSON.stringify(e.detail.response.returnval));
        var routereportresult=e.detail.response.returnval;
        document.querySelector('routereport-card').reportarr=routereportresult;
      },
      studentroutereport:function(routeid,tripid,pickordrop)
      {
        if(pickordrop=="Pickup")
        {
this.studentpickroutereporturl=sessionStorage.getItem("addrinfo")+"/studentpickroute-report-card";
        var obj={"routeid":"","tripid":""}
        obj.routeid=routeid;
        obj.tripid=tripid;
        this.studentpickroutereportparam=obj;
        //alert(JSON.stringify(obj));
        this.$.studentpickroutereportajax.generateRequest();
      }
      else
      {
        this.studentdroproutereporturl=sessionStorage.getItem("addrinfo")+"/studentdroproute-report-card";
        var obj={"routeid":"","tripid":""}
        obj.routeid=routeid;
        obj.tripid=tripid;
        this.studentdroproutereportparam=obj;
        //alert(JSON.stringify(obj));
        this.$.studentdroproutereportajax.generateRequest();
      }
      },
      studentpickroutereportResponse:function(e)
      {
        var routereportresult=e.detail.response.returnval;
        var no_of_student = routereportresult.length;
        document.querySelector('routereport-card').reportarr=routereportresult;
        document.querySelector('routereport-card').no_of_student=no_of_student;
        //alert(JSON.stringify(e.detail.response.returnval));
      },
       studentdroproutereportResponse:function(e)
      {
        var routereportresult=e.detail.response.returnval;
        var no_of_student= routereportresult.length;
        document.querySelector('routereport-card').reportarr=routereportresult;
        document.querySelector('routereport-card').no_of_student=no_of_student;
        //alert(JSON.stringify(e.detail.response.returnval));
      },
     gettrip:function(routename)
      {
        routetrip=routename;
        //alert('name of route'+routetrip);
        //alert('Hi');
        this.gettripurl=sessionStorage.getItem("addrinfo")+"/gettrip";
        var obj={"triproute":""};
        obj.triproute=routename;
        this.gettripparam=obj;
        //alert(JSON.stringify(obj));
        this.$.gettripajax.generateRequest();
      },
      gettripResponse:function(e1)
          { 
            //alert('i m back');
          var tripdetails=e1.detail.response.returnval;
          //alert(JSON.stringify(routedetails));
          document.querySelector('mappointtoroute-card').triparr=tripdetails;
      },
      //cancellation
      cancellation:function(studid){
        this.cancellationurl=sessionStorage.getItem("addrinfo")+"/cancellation";
        var obj={"studid":""}
        obj.studid=studid;
        this.cancellationparam=obj;
        //alert(JSON.stringify(obj));
        this.$.cancellationajax.generateRequest();
      },
      cancellationResponse:function(e){
        //alert(JSON.stringify(e.detail.response.returnval));
        var reportresult=e.detail.response.returnval;
        document.querySelector('cancellation-card').cancellationarr=reportresult;
      }, 
      cancel:function(school_type, fee, paid){
        this.cancelurl=sessionStorage.getItem("addrinfo")+"/cancel";
        var end_date = localStorage.getItem("localsess_curr_date",this.showdate);
        var obj={"school_type":"","end_date":""};
        obj.school_type=school_type;
        cancelfee = fee;
        cancelpaid = paid;
        obj.end_date=end_date;
        this.cancelparam=obj;
        this.$.cancelajax.generateRequest();
      },
      cancelResponse:function(e){
        var school_start_date = new Date(e.detail.response.returnval[0].start_date);
        var school_end_date = new Date(e.detail.response.returnval[0].end_date);
        var end_date = new Date(localStorage.getItem("localsess_curr_date",this.showdate));
        var a = (school_end_date.getFullYear() - school_start_date.getFullYear()) * 12;
        a += school_end_date.getMonth() - school_start_date.getMonth();
        if (school_end_date.getDate() < school_start_date.getDate()){
          a--;
        }
        var b = (end_date.getFullYear() - school_start_date.getFullYear()) * 12;
        b += end_date.getMonth() - school_start_date.getMonth();
        if (end_date.getDate() < school_start_date.getDate()){
          b--;
        }
        var total_months = a + 1;
        var months_used = b + 1;
        var totalamount = cancelfee;
        var paidamount = cancelpaid;
        var remaining_months = total_months - months_used;
        var percent = (remaining_months / total_months)*100;
       // alert("percent"+' '+percent);
        var total_refund_amount = (totalamount/100)*percent;
        //alert("refund"+' '+total_refund_amount);
        var used_amount = parseInt(totalamount - total_refund_amount);
        var refund_amount = paidamount - used_amount;
        //alert("refund_amount"+' '+refund_amount);
        document.querySelector('cancellation-item-card').months_used=months_used;
        document.querySelector('cancellation-item-card').total_months=total_months;
        document.querySelector('cancellation-item-card').refund_amount=refund_amount;
      },
      proceedcancellation:function(student_id, student_name, months_used, refund_amount, reason)
      {
        this.student_id=student_id;
        this.proceedcancelurl=sessionStorage.getItem("addrinfo")+"/proceedcancel";
        var obj={"student_id":"","student_name":"","months_used":"","refund_amount":"","reason":""}
        obj.student_id=student_id;
        obj.student_name=student_name;
        obj.months_used=months_used;
        obj.refund_amount=refund_amount;
        obj.reason = reason;
        this.proceedcancelparam=obj;
        this.$.proceedcancelajax.generateRequest();
      }, 
      proceedcancelResponse:function(e){
        var reportresult=e.detail.response.returnval;
        if(reportresult=='success'){
          alert('Cancellation Request is Sent Successfully');
              var obj={"student_id":""};
        obj.student_id=this.student_id;
        this.transportrequiredstatusparam=obj;
        this.transportrequiredstatusurl=sessionStorage.getItem("addrinfo")+"/transportrequiredstatus";
        this.$.transportrequiredstatusajax.generateRequest();
        this.statuschangeurl=sessionStorage.getItem("addrinfo")+"/statuschange";
        this.statuschangeparam=obj;
        this.$.statuschangeajax.generateRequest();
        this.pointflagurl=sessionStorage.getItem("addrinfo")+"/pointflag";
        this.pointflagparam=obj;
        this.$.pointflagajax.generateRequest();  
        }
        else{
          alert('Request Failed');
        }
        document.querySelector('cancellation-card').getrefreshcancel();
        document.querySelector('transport-app').setPage("cancellation","Transport Cancellation");
        
      },
       monthdiff:function(fromdate,todate){
        //alert('flow');
        var froms = fromdate;
        var to = todate;
        var d1 = new Date(froms);
        var d2=new Date(to);
        //alert('hi..'+d1+'   dvfa.. '+d2);
        months = (d2.getFullYear() - d1.getFullYear()) * 12;
        months -= d1.getMonth() + 1;
        months += d2.getMonth();
        var month = months+2;
        //alert(totalfee+'   '+month);
        cusfee = parseInt((totalfee/12)*month);
        //alert(cusfee);
      },
      name:function(){
        this.nameurl = sessionStorage.getItem("addrinfo")+"/name";
        this.$.nameajax.generateRequest();
      },
      nameResponse:function(e){
        var nameitem=e.detail.response.returnval;
        document.querySelector('cancellation-card').autocompletename(nameitem);
      },
      transportrequiredstatusResponse:function(e){

      },
      generatereportbyname:function(){
       this.generatereportbynameurl=sessionStorage.getItem("addrinfo")+"/generatereportbyname";
       this.$.generatereportbynameajax.generateRequest();
      },
      generatereportbynameResponse:function(e){
        var nameitem=e.detail.response.returnval; 
        document.querySelector('genestureport-card').autocompletename(nameitem);
      },
      deletemappoint:function(pointarray,routenam,tripnum)
      {
        this.deletemappointurl=sessionStorage.getItem("addrinfo")+"/deletemappoint-card";
        var obj={"pointarray":"","routenam":"","tripnum":""}
        obj.pointarray=pointarray;
        obj.routenam=routenam;
        obj.tripnum=tripnum;
        this.deletemappointparam=obj;
        this.$.deletemappointajax.generateRequest();
      },
      deletemappointResponse:function(e)
      {
        alert('Data Deleted successfully');
        document.querySelector('mappointtoroute-card').refreshdeletedata();
        
      },
       getstudapproval:function(){
        
        this.getstudapprovalurl=sessionStorage.getItem("addrinfo")+"/getstudapproval";
        this.$.getstudapprovalajax.generateRequest();
      },
      getstudapprovalResponse:function(e){
          var reqappro=e.detail.response.returnval;
          
          document.querySelector('approvediscount-card').approvearr=reqappro;

      },
      confirmdisc:function(stid,admrea,accdis,flag,status){
        var todat=new Date();
        var today=todat.getFullYear()+"/"+(todat.getMonth()+1)+"/"+todat.getDate();
        this.confirmdiscurl=sessionStorage.getItem("addrinfo")+"/confirmdisc";
        var obj={"stid":"","admrea":"","accdis":"","nowdate":"","flag":"","status":""}
        obj.stid=stid;
        obj.admrea=admrea;
        obj.accdis=accdis;
        obj.nowdate=today;
        obj.flag=flag;
        obj.status=status;
        this.confirmdiscparam=obj;
        this.$.confirmdiscajax.generateRequest();
      },
      confirmdiscResponse:function(e){
        var resultx=e.detail.response.returnval;
        if(resultx=='success'){
          alert('Updation successfully');
        } else {
          alert('Updation Failed');
        }
      },
      getapprovalverify:function(){
        
        this.getapprovalverifyurl=sessionStorage.getItem("addrinfo")+"/getapprovalverify";
        this.$.getapprovalverifyajax.generateRequest();
      },
      getapprovalverifyResponse:function(e){
          var verifyreq=[];
          verifyreq=e.detail.response;
          //alert(JSON.stringify(verifyreq));
          //verifyreq=[{"name":"dsddsds"},{"name":"eerrere"}];
          document.querySelector('discountverify-card').theriarr=verifyreq;
          //alert(JSON.stringify(document.querySelector('discountverify-card').theriarr));
      },
      confirmedfee:function(stid,fee,status,flag){
        var todat=new Date();
        var today=todat.getFullYear()+"/"+(todat.getMonth()+1)+"/"+todat.getDate();
        this.confirmedfeeurl=sessionStorage.getItem("addrinfo")+"/confirmedfee";
        var obj={"stid":"","fees":"","status":"","date":"","flag":""}
        obj.stid=stid;
        obj.fees=fee;
        obj.status=status;
        obj.date=today;
        obj.flag=flag;
        this.confirmedfeeparam=obj;
        this.$.confirmedfeeajax.generateRequest();
        this.confirmfeeurl=sessionStorage.getItem("addrinfo")+"/confirmfee";
        var obj={"stid":"","fees":""}
        obj.stid=stid;
        obj.fees=fee;
        this.confirmfeeparam=obj;
        this.$.confirmfeeajax.generateRequest();
      },
      
      confirmfeeResponse:function(e){
          var verifyres=e.detail.response.returnval;
          if(verifyres=='success')
          {
            alert('Fee is confirmed and updatede');
          }
          else
          {
            alert('Operation Failed');
          }
      },
      cancelledfee:function(stid,status,flag){
        this.cancelledfeeurl=sessionStorage.getItem("addrinfo")+"/cancelledfee";
        var obj={"stid":"","status":"","flag":""}
        obj.stid=stid;
        obj.status=status;
        obj.flag=flag;
        this.cancelledfeeparam=obj;
        this.$.cancelledfeeajax.generateRequest();
      },
      cancelledfeeResponse:function(e)
      {
        var resltzx=e.detail.response.returnval;
        if(resltzx=='success')
        {
            alert('Request Cancelled');
        }
        else
        {
            alert('Operation Interupted');
        }
      },
      oneway:function(){
        
        this.onewayurl="../../configfile/modeofway.json";
        this.$.onewayajax.generateRequest(); 

        
      },
      onewayResponse:function(e){
        
          var temp=[];
          temp=e.detail.response;
        
          oneway=temp[0].oneway;
        
          val=(yearlyfee/100)*oneway;

      document.querySelector('zonetostudent-card').fee=val;
      },
      onecus:function(){
           this.onecusurl="../../configfile/modeofway.json";
        this.$.onecusajax.generateRequest(); 
        },
      onecusResponse:function(e){
            var temp=[];
          temp=e.detail.response;
        
          oneway=temp[0].oneway;
        
              val=(cusfee/100)*oneway;
         document.querySelector('zonetostudent-card').fee=val;
      
      },
      twoway:function(){
      val=yearlyfee;
      document.querySelector('zonetostudent-card').fee=val;   
      },
      twocus:function(){
        val=cusfee;
        document.querySelector('zonetostudent-card').fee=val;
      },
       studzone:function(id){
              this.studzoneurl=sessionStorage.getItem("addrinfo")+"/getstudzone";
              var obj={"stid":""}
              obj.stid=id;
              
              this.studzoneparam=obj;
              
              this.$.studzoneajax.generateRequest();
        },
        studzoneResponse:function(e){
          var status=e.detail.response.returnval;
              if(status=='mapped'){
                alert('The student is already mapped You Cannot Map again');
              }
            document.querySelector('zonetostudent-card').status=status;
        },
        updatezone:function(studid,zone,fee,fromdatez,todatez,modez,namex,todayx,statusx)
      {
        this.updatezoneurl = sessionStorage.getItem("addrinfo")+"/updatezone";
        var obj={"studid":"","zone":"","fee":"","fromdate":"","todate":"","mode":"","name":"","today":"","status":""};
        obj.studid=studid;
        obj.zone=zone;
        obj.fee=fee;
        obj.fromdate=fromdatez;
        obj.todate=todatez;
        obj.mode=modez;
        obj.name=namex;
        obj.today=todayx;
        obj.status=statusx;
        this.updatezoneparam=obj;
       // alert(JSON.stringify(obj));
        this.$.updatezoneajax.generateRequest();
      },
      updatezoneResponse:function(e){
         var result=e.detail.response.returnval;
         //alert(result);
         if(result=="success")
         {
          alert('Updation done successfully');
         }
         else
         {
          alert('Updation interrupt');
         }
      },
      getpassdetail:function(studid){
          this.getpassnameurl=sessionStorage.getItem("addrinfo")+"/getpassname";
              var obj={"stid":""}
              obj.stid=studid;
              this.getpassnameparam=obj;
              this.$.getpassnameajax.generateRequest();
      },
      getpassnameResponse:function(e){
          var idst=e.detail.response.returnval[0].id;
          var classid=e.detail.response.returnval[0].class_id;
          var bloodgp=e.detail.response.returnval[0].blood_group;
          document.querySelector('studentpass-card').blood=bloodgp;
          document.querySelector('studentpass-card').sid=idst;
          this.getpassdetailurl=sessionStorage.getItem("addrinfo")+"/getpassdetail";
          var obj={"stid":""}
          obj.stid=idst;
          this.getpassdetailparam=obj;
          this.$.getpassdetailajax.generateRequest();


          this.getparentinfourl=sessionStorage.getItem("addrinfo")+"/getparentinfo";
          this.getparentinfoparam=obj;
          this.$.getparentinfoajax.generateRequest();


          this.getpassclassurl=sessionStorage.getItem("addrinfo")+"/getpassclass";
          var obj3={"class":""}
          obj3.class=classid;
          this.getpassclassparam=obj3;
          this.$.getpassclassajax.generateRequest();
      },
       getpassdetailResponse:function(e){
        var pp=e.detail.response.returnval[0].pickup_point;
        var dp=e.detail.response.returnval[0].drop_point;

          this.getppnameurl=sessionStorage.getItem("addrinfo")+"/getpointname";
              var obj={"point":""}
              obj.point=pp;
             this.getppnameparam=obj;
              this.$.getppnameajax.generateRequest();

          this.getdpnameurl=sessionStorage.getItem("addrinfo")+"/getpointname";
          var obj2={"point":""}
          obj2.point=dp;
          this.getdpnameparam=obj2;
          this.$.getdpnameajax.generateRequest();     
        },
        getppnameResponse:function(e){
            var pickupoint=e.detail.response.returnval[0].point_name;
            document.querySelector('studentpass-card').pickup=pickupoint;
        },
        getdpnameResponse:function(e){
            var droppoint=e.detail.response.returnval[0].point_name;
            document.querySelector('studentpass-card').drop=droppoint;
        },
        getpassclassResponse:function(e){
            var standard=e.detail.response.returnval[0].class;
            var section=e.detail.response.returnval[0].section;
            document.querySelector('studentpass-card').stnd=standard;
            document.querySelector('studentpass-card').sec=section;
        },
        getparentinfoResponse:function(e){
          var dad=e.detail.response.returnval[0].parent_name;
            var add1=e.detail.response.returnval[0].address_1;
            var add2=e.detail.response.returnval[0].address_2;
            var add3=e.detail.response.returnval[0].town;
            var pin=e.detail.response.returnval[0].pincode;
            var mob=e.detail.response.returnval[0].mobile;
            document.querySelector('studentpass-card').parent=dad;
            document.querySelector('studentpass-card').address1=add1;
            document.querySelector('studentpass-card').address2=add2;
            document.querySelector('studentpass-card').town=add3;
            document.querySelector('studentpass-card').pin=pin;
            document.querySelector('studentpass-card').mobno=mob;
            
        }

    });
 })();
  </script>

</dom-module>

